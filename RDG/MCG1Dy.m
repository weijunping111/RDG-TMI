function U=MCG1Dy(b,dt,Theta,u)

ITE=2;
N=128;
%dt=0.00025;
%b=(1/alfa)*b;
%p=dt*Theta/2;


U=zeros(N+1,N+1);

% for i=1:N+1
%     U(i,1)=0;
%     U(i,N+1)=0;
%     U(1,i)=0;
%     U(N+1,i)=0;
% end

NN=(N/32-1);

U2h=zeros(N/2+1);
U4h=zeros(N/4+1);
U8h=zeros(N/8+1);
U16h=zeros(N/16+1);
U32h=zeros(N/32+1);
U2ht=zeros(N/2+1);
U4ht=zeros(N/4+1);
U8ht=zeros(N/8+1);
U16ht=zeros(N/16+1);

Uht=zeros(N+1,N+1);

A32h=zeros(NN,NN);
r32h=zeros(NN,1);

RH=zeros(N+1);
R2H=zeros(N/2+1);
R4H=zeros(N/4+1);
R8H=zeros(N/8+1);
R16H=zeros(N/16+1);

F2H=zeros(N/2+1);
F4H=zeros(N/4+1);
F8H=zeros(N/8+1);
F16H=zeros(N/16+1);


H1=1;
H2=2;
H4=4;
H8=8;
H16=16;
H32=32;


p1=dt*Theta/(H1)^2;
p2=dt*Theta/(H2)^2;
p4=dt*Theta/(H4)^2;
p8=dt*Theta/(H8)^2;
p16=dt*Theta/(H16)^2;
p32=dt*Theta/(H32)^2;

%%%%%%%%%%%%%%%%%%%revise%%%%%%%%%%%%%%%%%%%%%%%%%%%%
A32h(1,1:3)=[1+2*p32,-p32,0];
A32h(2,1:3)=[-p32,1+2*p32,-p32];
A32h(3,1:3)=[0,-p32,1+2*p32];
%%%%%%%%%%%%%%%%%%%revise%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%J%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
for i=2:N
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%J%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


esp=1;
kkk=0;
%%%%%%%%%%%%%%%%%%%%%%%%%while%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
while esp>1e-6 && kkk<=1
%%%%%%%%%%%%%%%%%%%%%%%%%while%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    kkk=kkk+1;
U0=U;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%------------------------------------h-Relax------------------------------------------------------------------------------
for n=1:ITE   
VV=U;
for j=2:N
U(i,j)=(u(i,j)-dt*b(i,j)+p1*(u(i+1,j)-2*u(i,j)+u(i-1,j))+p1*(VV(i,j+1)+VV(i,j-1)))/(1.0+2*p1);
end

end
%------------------------------------h-Relax------------------------------------------------------------------------------
%-------------------------------------transform---------------------------------------------------------------------------
for j=1:N-1   
RH(1+j)=u(i,j+1)-dt*b(i,j+1)+p1*(u(i+1,j+1)-2*u(i,j+1)+u(i-1,j+1))+p1*(U(i,j+2)+U(i,j))-(1+2*p1)*U(i,j+1);
end

%FH=RH;

for j=2:N/2    
ii=j-1;
F2H(j)=1.0/4.0*(RH(2*ii)+2*RH(2*ii+1)+RH(2*ii+2));
end
%-------------------------------------transform---------------------------------------------------------------------------
%------------------------------------2h-Relax------------------------------------------------------------------------------
VV2h=zeros(N/2+1);
for n=1:ITE     
for j=2:N/2
U2h(j)=(F2H(j)+p2*(VV2h(j+1)+VV2h(j-1)))/(1+2*p2);
end
VV2h=U2h;
end
%------------------------------------2h-Relax------------------------------------------------------------------------------
%-------------------------------------transform---------------------------------------------------------------------------
  
for j=1:N/2-1
R2H(1+j)=F2H(j+1)+p2*(U2h(j+2)+U2h(j))-(1+2*p2)*U2h(j+1);
end


for j=2:N/4    
ii=j-1;
F4H(j)=1/4.0*(R2H(2*ii)+2*R2H(2*ii+1)+R2H(2*ii+2));
end

%F4H=R4H;


%-------------------------------------transform---------------------------------------------------------------------------
%------------------------------------4h-Relax------------------------------------------------------------------------------
VV4h=zeros(N/4+1);
for n=1:ITE    
for j=2:N/4
U4h(j)=(F4H(j)+p4*(VV4h(j+1)+VV4h(j-1)))/(1+2*p4);
end
VV4h=U4h;
end
%------------------------------------4h-Relax------------------------------------------------------------------------------

%-------------------------------------transform---------------------------------------------------------------------------
for j=1:N/4-1  
R4H(1+j)=F4H(j+1)+p4*(U4h(j+2)+U4h(j))-(1+2*p4)*U4h(j+1);
end

for j=2:N/8   
ii=j-1;
F8H(j)=1/4.0*(R4H(2*ii)+2*R4H(2*ii+1)+R4H(2*ii+2));
end
%-------------------------------------transform---------------------------------------------------------------------------
%------------------------------------8h-Relax------------------------------------------------------------------------------
VV8h=zeros(N/8+1);
for n=1:ITE    
for j=2:N/8
U8h(j)=(F8H(j)+p8*(VV8h(j+1)+VV8h(j-1)))/(1+2*p8);
end
VV8h=U8h;
end
%------------------------------------8h-Relax------------------------------------------------------------------------------
%-------------------------------------transform---------------------------------------------------------------------------
for j=1:N/8-1   
R8H(1+j)=F8H(j+1)+p8*(U8h(j+2)+U8h(j))-(1+2*p8)*U8h(j+1);
end

for j=2:N/16    
ii=j-1;
F16H(j)=1/4.0*(R8H(2*ii)+2*R8H(2*ii+1)+R8H(2*ii+2));
end

%-------------------------------------transform---------------------------------------------------------------------------
%------------------------------------16h-Relax------------------------------------------------------------------------------
VV16h=zeros(N/16+1);
for n=1:ITE    
for j=2:N/16
U16h(j)=(F16H(j)+p16*(VV16h(j+1)+VV16h(j-1)))/(1+2*p16);
end
VV16h=U16h;
end
%------------------------------------16h-Relax------------------------------------------------------------------------------
%-------------------------------------transform---------------------------------------------------------------------------
for j=1:N/16-1   
R16H(1+j)=F16H(j+1)+p16*(U16h(j+2)+U16h(j))-(1+2*p16)*U16h(j+1);
end


for j=2:N/32
ii=j-1;
r32h(ii)=1/4.0*(R16H(2*ii)+2*R16H(2*ii+1)+R16H(2*ii+2));
end


%-------------------------------------transform---------------------------------------------------------------------------

%------------------------------------32h-Solve------------------------------------------------------------------------------
BB32h=r32h;
temp=A32h\BB32h;
for j=1:3
U32h(j+1)=temp(j);
end

%------------------------------------32h-Solve------------------------------------------------------------------------------

%-------------------------------------transform---------------------------------------------------------------------------
for j=1:N/32
ii=j-1;
U16ht(2*ii+1)=U32h(ii+1);
U16ht(2*ii+2)=0.5*(U32h(ii+1)+U32h(ii+2));
end

for j=2:N/16
U16h(j)=U16ht(j)+U16h(j);
end
%-------------------------------------transform---------------------------------------------------------------------------

%------------------------------------16h-Relax------------------------------------------------------------------------------
for n=1:ITE
VV16h=U16h;
for j=2:N/16
U16h(j)=(F16H(j)+p16*(VV16h(j+1)+VV16h(j-1)))/(1.0+2*p16);
end
end

%------------------------------------16h-Relax------------------------------------------------------------------------------
%-------------------------------------transform---------------------------------------------------------------------------
for j=1:N/16
ii=j-1;
U8ht(2*ii+1)=U16h(ii+1);
U8ht(2*ii+2)=0.5*(U16h(ii+1)+U16h(ii+2));
end
for j=2:N/8
U8h(j)=U8ht(j)+U8h(j);
end

%-------------------------------------transform---------------------------------------------------------------------------
%------------------------------------8h-Relax------------------------------------------------------------------------------
for n=1:ITE
VV8h=U8h;
for j=2:N/8
U8h(j)=(F8H(j)+p8*(VV8h(j+1)+VV8h(j-1)))/(1.0+2*p8);
end
end

%------------------------------------8h-Relax------------------------------------------------------------------------------
%-------------------------------------transform---------------------------------------------------------------------------
for j=1:N/8
ii=j-1;
U4ht(2*ii+1)=U8h(ii+1);
U4ht(2*ii+2)=0.5*(U8h(ii+1)+U8h(ii+2));
end

for j=2:N/4
U4h(j)=U4ht(j)+U4h(j);
end

%-------------------------------------transform---------------------------------------------------------------------------
%------------------------------------4h-Relax------------------------------------------------------------------------------
for n=1:ITE
VV4h=U4h;
for j=2:N/4
U4h(j)=(F4H(j)+p4*(VV4h(j+1)+VV4h(j-1)))/(1.0+2*p4);
end
end

%------------------------------------4h-Relax------------------------------------------------------------------------------
%-------------------------------------transform---------------------------------------------------------------------------
for j=1:N/4
ii=j-1;
U2ht(2*ii+1)=U4h(ii+1);
U2ht(2*ii+2)=0.5*(U4h(ii+1)+U4h(ii+2));
end

for j=2:N/2
U2h(j)=U2ht(j)+U2h(j);
end

%-------------------------------------transform---------------------------------------------------------------------------
%------------------------------------2h-Relax------------------------------------------------------------------------------
for n=1:ITE
VV2h=U2h;
for j=2:N/2
U2h(j)=(F2H(j)+p4*(VV2h(j+1)+VV2h(j-1)))/(1.0+2*p4);
end
end

%------------------------------------2h-Relax------------------------------------------------------------------------------
%-------------------------------------transform---------------------------------------------------------------------------
for j=1:N/2
ii=j-1;
Uht(i,2*ii+1)=U2h(ii+1);
Uht(i,2*ii+2)=0.5*(U2h(ii+1)+U2h(ii+2));
end

%-------------------------------------transform---------------------------------------------------------------------------
%------------------------------------h-Relax------------------------------------------------------------------------------
for j=2:N
U(i,j)=Uht(i,j)+U(i,j);
end

for n=1:ITE
VVh=U;
for j=2:N
U(i,j)=(u(i,j)-dt*b(i,j)+p1*(u(i+1,j)-2*u(i,j)+u(i-1,j))+p1*(VVh(i,j+1)+VVh(i,j-1)))/(1.0+2*p1);
end
end
HH=U-U0;
esp=max(max(abs(HH)));
end
%------------------------------------h-Relax------------------------------------------------------------------------------
end 
%%%%%%%%%%%%%%%%%%%%%%%%%while%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%VÑ­»·%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%J%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%J%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

